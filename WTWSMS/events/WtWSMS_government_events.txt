###############################
# Government events
#
# 
#
# 
###############################

namespace = WtWSMS_govs

###############################
# Initial Sub-Roman flag
###############################

# Independent character with a Sub-Roman government
character_event = {
	id = WtWSMS_govs.1

	hide_window = yes
	
	only_playable = yes
	only_independent = yes # Tax-collecting is done at state-level, although naturally vassals get the land later on and their cultural values shift. 

	trigger = {
		government = sub_roman_government # This is based upon the Romano-Germanic kingdoms, doesn't necessarily fit for other realms who had more tribal patterns...
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		primary_title = { 
			set_title_flag = sub_roman_government_flag
		}
	}
}

# Independent character no longer has a Sub-Roman government
character_event = {
	id = WtWSMS_govs.2

	hide_window = yes
	
	only_playable = yes
	only_independent = yes

	trigger = {
		NOT = { government = sub_roman_government }
		primary_title = { 
			has_title_flag = sub_roman_government_flag
		}
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		clr_title_flag = sub_roman_government_flag
	}
}

###############################
# Roman taxation
###############################

# Sub-Roman ruler gets the choice of maintaining the old taxation after ~50 years, step one
character_event = {
	id = WtWSMS_govs.3
	title = WtWSMS_govs.3.name
	desc = WtWSMS_govs.3.desc
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_economy
	
	only_playable = yes
	only_independent = yes
	
	trigger = {
		primary_title = {
			has_title_flag = sub_roman_government_flag
			had_title_flag = { 
				flag = sub_roman_government_flag 
				days = 18250 # 50 years
			}
			NOT = { has_title_flag = first_event_feudal_transition } # Don't want the event to fire again
		}
		government = sub_roman_government
	}
	
	mean_time_to_happen = {
		years = 10 # A minimum of 50 years with "had_title_flag", then 10 years at random
	}
	
	immediate = {
		primary_title = {
			set_title_flag = first_event_feudal_transition
		}
	}
	
	option = {
		name = WtWSMS_govs.3.a # Yes, maintain, costs money, increases revolt risk in reaction to taxation for the peasants and decreases opinions for the aristocracy, delay a bit -> 50 years
		ai_chance = {
			#Option A modifiers
		}
		scaled_wealth = -1 # Maintaining taxation has a cost...
		any_realm_province = {
			add_province_modifier = {
				name = maintained_roman_taxation_infrastructure
				duration = -1 
			}
		}
		any_vassal = {
			opinion = {
				modifier = maintained_roman_taxes 
				who = ROOT 
				years = 10
			}
		}
		character_event	= { # Repeat ~fifty years later
			id = WtWSMS_govs.3
			days = 18250 # 50 years
			random = 3650 # 10 years
		}
	}
	
	option = {
		name = WtWSMS_govs.3.b # No, less income permanently -> Step one for becomming feudal
		ai_chance = {
			#Option B modifiers
		}
		any_realm_province = {
			add_province_modifier = {
				name = neglected_roman_taxation_infrastructure
				duration = -1 
			}
		}
		primary_title = { 
			set_title_flag = first_step_feudal
			set_variable = { 
				which = feudal_transition_variable 
				value = 1 
			}
		}
	}
}

# Sub-Roman ruler gets the choice of further maintaining remains of old fiscal system after ~50 more years, step two
character_event = {
	id = WtWSMS_govs.4
	title = WtWSMS_govs.4.name
	desc = WtWSMS_govs.4.desc
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_economy
	
	only_playable = yes
	only_independent = yes
	
	trigger = {
		primary_title = {
			has_title_flag = sub_roman_government_flag
			had_title_flag = { 
				flag = first_step_feudal 
				days = 18250 # 50 years
			}
			NOT = { has_title_flag = second_event_feudal_transition } # Don't want the event to fire again
		}
		government = sub_roman_governmen
	}
	
	mean_time_to_happen = {
		years = 10 # A minimum of 50 years with "had_title_flag", then 10 years at random
	}
	
	immediate = {
		primary_title = {
			set_title_flag = second_event_feudal_transition
		}
	}
	
	option = {
		name = WtWSMS_govs.4.a # Yes, maintain, costs money, increases revolt risk in reaction to taxation for the peasants and decreases opinions for the aristocracy, delay a bit -> 50 years
		ai_chance = {
			#Option A modifiers
		}
		scaled_wealth = -2 # Maintaining taxation has a cost...
		any_realm_province = {
			add_province_modifier = {
				name = maintained_roman_taxation_infrastructure
				duration = -1 
			}
		}
		any_vassal = { 
			opinion = {
				modifier = maintained_roman_taxes 
				who = ROOT 
				years = 10
			}
		}
		character_event	= { # Repeat ~fifty years later
			id = WtWSMS_govs.5
			days = 18250 # 50 years
			random = 3650 # 10 years
		}
	}
	
	option = {
		name = WtWSMS_govs.4.b # No, less income permanently -> Step one for becomming feudal
		ai_chance = {
			#Option B modifiers
		}
		any_realm_province = {
			limit = {
				has_province_flag = neglected_roman_taxation_infrastructure
			}
			clr_province_flag = neglected_roman_taxation_infrastructure
		}
		any_realm_province = {
			add_province_modifier = {
				name = abandoned_roman_taxation_infrastructure
				duration = -1 
			}
		}
		primary_title = { 
			set_title_flag = second_step_feudal
			change_variable = { 
				which = feudal_transition_variable
				value = 1
			}
		}
	}
}

# Sub-Roman ruler gets the choice of maintaining last vestiges of the old fiscal system after ~50 more years, step three
character_event = {
	id = WtWSMS_govs.5
	title = WtWSMS_govs.5.name
	desc = WtWSMS_govs.5.desc
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_economy
	
	only_playable = yes
	only_independent = yes
	
	trigger = {
		primary_title = {
			has_title_flag = sub_roman_government_flag
			had_title_flag = { 
				flag = second_step_feudal 
				days = 18250 # 50 years
			}
			NOT = { has_title_flag = third_event_feudal_transition } # Don't want the event to fire again
		}
		government = sub_roman_government
	}
	
	mean_time_to_happen = {
		years = 10 # A minimum of 50 years with "had_title_flag", then 10 years at random
	}
	
	immediate = {
		primary_title = {
			set_title_flag = third_event_feudal_transition
		}
	}
	
	option = {
		name = WtWSMS_govs.5.a # Yes, maintain, costs money, increases revolt risk in reaction to taxation for the peasants and decreases opinions for the aristocracy, delay a bit -> 50 years
		ai_chance = {
			#Option A modifiers
		}
		scaled_wealth = -3 # Maintaining taxation has a cost...
		any_realm_province = {
			add_province_modifier = {
				name = maintained_roman_taxation_infrastructure
				duration = -1 
			}
		}
		any_vassal = {
			opinion = {
				modifier = maintained_roman_taxes 
				who = ROOT 
				years = 10
			}
		}
		character_event	= { # Repeat ~fifty years later
			id = WtWSMS_govs.5
			days = 18250 # 50 years
			random = 3650 # 10 years
		}
	}
	
	option = {
		name = WtWSMS_govs.5.b # No, less income permanently -> Step one for becomming feudal
		ai_chance = {
			#Option B modifiers
		}
		any_realm_province = {
			limit = {
				has_province_flag = abandoned_roman_taxation_infrastructure
			}
			clr_province_flag = abandoned_roman_taxation_infrastructure
		}
		any_realm_province = {
			add_province_modifier = {
				name = nonexistent_roman_taxation_infrastructure
				duration = -1 
			}
		}
		primary_title = { 
			set_title_flag = third_step_feudal
			change_variable = {
				which = feudal_transition_variable
				value = 1
			}
		}
	}
}

# Vassals of a Sub-Roman liege asks for abandoning Roman fiscal system
character_event = {
	id = WtWSMS_govs.6
	title = WtWSMS_govs.6.name
	desc = WtWSMS_govs.6.desc
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_economy
	
	only_playable = yes
	
	trigger = {
		top_liege = {
			primary_title = {
				has_title_flag = sub_roman_government_flag
				had_title_flag = { 
					flag = sub_roman_government_flag 
					days = 18250 # 50 years
				}
				NOT = { has_title_flag = first_step_feudal } # Don't want the same to fire twice
			}
		}
		government = sub_roman_government
		higher_tier_than = BARON
	}
	
	mean_time_to_happen = {
		years = 10 # A minimum of 50 years with "had_title_flag", then 10 years at random
	}
	
	option = {
		name = WtWSMS_govs.6.a # Ask to abandon
		top_liege = { 
			character_event	= { 
				id = WtWSMS_govs.7
				days = 3 # Instant events can cause issues for AI calculation
			}
		}
	}
	
	option = {
		name = WtWSMS_govs.6.b # Let it be
		trigger = {
			ai = no # Why would the AI want to pay taxes?
		}
	}
}

# Liege receives vassal request of abandoning Roman fiscal system
character_event = {
	id = WtWSMS_govs.7
	title = WtWSMS_govs.7.name
	desc = WtWSMS_govs.7.desc
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = { # Accept to abandon
		name = WtWSMS_govs.7.a
		ai_chance = {
			#Option A modifiers
		}
		# Vassal pleased
		any_realm_province = {
			add_province_modifier = {
				name = neglected_roman_taxation_infrastructure
				duration = -1 
			}
		}
		primary_title = { 
			set_title_flag = first_step_feudal
			set_variable = { 
				which = feudal_transition_variable 
				value = 1 
			}
		}
		FROM = {
			character_event	= {
				id = WtWSMS_govs.8 # Liege accepts vassal request of abandoning Roman fiscal system
				days = 3 # Instant events can cause issues for AI calculation
			}
		}
	}
	
	option = { # Refuse to abandon
		name = WtWSMS_govs.7.b
		ai_chance = {
			#Option B modifiers
		}
		FROM = {
			opinion = {
				modifier = maintained_roman_taxes 
				who = ROOT 
				years = 10
			}
			character_event	= {
				id = WtWSMS_govs.9 # Liege refuses vassal request of abandoning Roman fiscal system
				days = 3 # Instant events can cause issues for AI calculation
			}
		}
	}
}

# Liege accepts vassal request of abandoning Roman fiscal system
character_event = {
	id = WtWSMS_govs.8
	desc = WtWSMS_govs.8.desc
	picture = GFX_evt_throne_room

	is_triggered_only = yes

	option = {
		name = WtWSMS_govs.8.a
	}
}

# Liege refuses vassal request of abandoning Roman fiscal system
character_event = {
	id = WtWSMS_govs.9
	desc = WtWSMS_govs.9.desc
	picture = GFX_evt_throne_room

	is_triggered_only = yes

	option = {
		name = WtWSMS_govs.9.a
	}
}

###############################
# Crisis
###############################

# Crisis caused by war and looting
character_event = {
	id = WtWSMS_govs.10
	desc = WtWSMS_govs.10.desc
	picture = GFX_evt_warband_on_hill
	
	only_playable = yes
	
	trigger = {
		primary_title = {
			has_title_flag = sub_roman_government_flag
			NOT = { has_title_flag = war_crisis } # Don't want the event to fire again
		}
		government = sub_roman_government
		war = yes
		any_realm_province = {
			has_province_modifier = devastated_war # Has been sieged five times
		}
	}
	
	mean_time_to_happen = {
		years = 10 # A rather long period of war(s)
	}
	
	immediate = {
		primary_title = {
			set_title_flag = war_crisis
		}
		if = { # Hasn't started transition
			limit = {
				is_variable_equal = {
					which = feudal_transition_variable 
					value = 0
				}	
			}
			set_variable = {
				which = feudal_transition_variable 
				value = 1
			}
		}
		else = { # Has started transition
			change_variable = {
				which = feudal_transition_variable
				value = 1
			}
		}
	}

	option = {
		name = WtWSMS_govs.10.a
		prestige = -100
	}
}

# Crisis makes it hard for institutions to continue properly

###############################
# Landed armies
###############################

# Sources of money-spending, less money spent on the army with landed army
character_event = {
	id = WtWSMS_govs.11
	desc = WtWSMS_govs.11.desc
	picture = GFX_evt_warband_on_hill # Replace me!
	
	only_playable = yes
	
	trigger = {
		primary_title = {
			has_title_flag = sub_roman_government_flag
			NOT = { has_title_flag = landed_army } # Don't want the event to fire again
		}
		government = sub_roman_government
		check_variable = { # Less retinues
			which = retinue_size 
			value <= 4 # Number based upon the modifier values
		}
		realm_levies >=	2000 # Larger army
	}
	
	mean_time_to_happen = {
		years = 10 # While you can't check for how many years this has been the case it makes sense to have a longer MTTH
	}
	
	immediate = {
		primary_title = {
			set_title_flag = landed_army
		}
		if = { # Hasn't started transition
			limit = {
				is_variable_equal = {
					which = feudal_transition_variable 
					value = 0
				}	
			}
			set_variable = {
				which = feudal_transition_variable 
				value = 1
			}
		}
		else = { # Has started transition
			change_variable = {
				which = feudal_transition_variable
				value = 1
			}
		}
	}
	
	option = {
		name = WtWSMS_govs.11.a
	}
}

# Landed army makes it less necessary to collect taxes that would have been spent on the army

# changed cultural values of the aristocracy and social status of the army (in-game vassals with military education and strong martial but weak other stats)
# Minimum of 4 variables, but likelier the more you have